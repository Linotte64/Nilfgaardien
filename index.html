<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Traducteur de Langue Construite</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            text-align: center;
            padding: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .translator-section {
            padding: 40px;
        }

        .language-selector {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 30px;
            gap: 20px;
        }

        .lang-option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .lang-option.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
        }

        .swap-btn {
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            color: white;
            font-size: 20px;
            transition: transform 0.3s ease;
        }

        .swap-btn:hover {
            transform: rotate(180deg);
        }

        .translation-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .input-section {
            position: relative;
        }

        .input-section h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        textarea {
            width: 100%;
            height: 150px;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            font-size: 16px;
            resize: none;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .translate-btn {
            display: block;
            width: 200px;
            margin: 20px auto;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .translate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .analysis {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .analysis h4 {
            color: #495057;
            margin-bottom: 10px;
        }

        .word-analysis {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .word-tag {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 5px 10px;
            font-size: 14px;
        }

        .dictionary {
            background: #fff;
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            border: 1px solid #e9ecef;
        }

        .dictionary h3 {
            color: #495057;
            margin-bottom: 15px;
        }

        .dict-entry {
            padding: 8px 0;
            border-bottom: 1px solid #f1f3f4;
        }

        .dict-entry:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>✨ Traducteur de Langue Construite ✨</h1>
            <p>Prototype de traduction intelligente avec analyse grammaticale</p>
        </div>

        <div class="translator-section">
            <div class="language-selector">
                <div class="lang-option active" data-lang="conlang">Votre Langue</div>
                <button class="swap-btn" onclick="swapLanguages()">⇄</button>
                <div class="lang-option" data-lang="french">Français</div>
            </div>

            <div class="translation-area">
                <div class="input-section">
                    <h3 id="input-label">Votre Langue</h3>
                    <textarea id="input-text" placeholder="Saisissez votre texte ici...">Skel gorval drae'skorr grurnir osk kravnyar nork</textarea>
                </div>
                <div class="input-section">
                    <h3 id="output-label">Français</h3>
                    <textarea id="output-text" placeholder="La traduction apparaîtra ici..." readonly></textarea>
                </div>
            </div>

            <button class="translate-btn" onclick="translate()">🔄 Traduire</button>

            <div class="analysis" id="analysis" style="display: none;">
                <h4>📋 Analyse Grammaticale</h4>
                <div id="word-analysis" class="word-analysis"></div>
                <div id="grammar-notes"></div>
            </div>

            <div class="dictionary">
                <h3>📚 Dictionnaire</h3>
                <div id="dictionary-content"></div>
            </div>
        </div>
    </div>

    <script>
        // Base de données linguistique - Structure plus intelligente
        const lexicon = {
            // Mots de base
            'skel': { fr: 'la', type: 'article', gender: 'f' },
            'gorval': { fr: 'bête', type: 'nom', gender: 'f', subject: 'il' }, // Détermine la conjugaison
            'drae\'skorr': { fr: 'sauvage', type: 'adjectif' },
            'osk': { fr: 'mais', type: 'conjonction' },
            'nork': { fr: 'ne...pas', type: 'négation' }
        };

        // Base de données des verbes avec radicaux
        const verbs = {
            'grurnir': { radical: 'grurn', fr: 'grogner' },
            'kravnyar': { radical: 'kravny', fr: 'mordre' }
        };

        // Terminaisons de conjugaison
        const conjugationEndings = {
            'je': 'en',
            'tu': 'es',
            'il': '', // infinitif sans modification
            'elle': '', 
            'nous': 'avam',
            'vous': 'avel',
            'ils': 'arin',
            'elles': 'arin'
        };

        // Correspondances français vers personnes
        const frenchSubjects = {
            'je': 'je',
            'tu': 'tu', 
            'il': 'il',
            'elle': 'elle',
            'nous': 'nous',
            'vous': 'vous',
            'ils': 'ils',
            'elles': 'elles',
            'la bête': 'il', // Sujets spéciaux
            'le chat': 'il',
            'l\'animal': 'il'
        };

        // Génération automatique de toutes les formes conjuguées
        function generateAllConjugations() {
            const fullLexicon = { ...lexicon };
            
            // Pour chaque verbe, générer toutes les conjugaisons
            Object.keys(verbs).forEach(infinitif => {
                const verb = verbs[infinitif];
                
                // Ajouter l'infinitif
                fullLexicon[infinitif] = {
                    fr: verb.fr,
                    type: 'verbe',
                    infinitive: infinitif,
                    radical: verb.radical,
                    person: 'il' // 3e personne = infinitif
                };
                
                // Générer toutes les conjugaisons
                Object.keys(conjugationEndings).forEach(person => {
                    const ending = conjugationEndings[person];
                    const conjugatedForm = person === 'il' || person === 'elle' ? 
                        infinitif : verb.radical + ending;
                    
                    // Traductions françaises selon la personne
                    let frenchTranslation = '';
                    if (person === 'je' || person === 'tu') {
                        frenchTranslation = verb.fr.replace(/er$/, 'e').replace(/ir$/, 's').replace(/re$/, 's');
                    } else if (person === 'il' || person === 'elle') {
                        frenchTranslation = verb.fr.replace(/er$/, 'e').replace(/ir$/, 't').replace(/re$/, '');
                    } else if (person === 'nous') {
                        frenchTranslation = verb.fr.replace(/er$/, 'ons').replace(/ir$/, 'ons').replace(/re$/, 'ons');
                    } else if (person === 'vous') {
                        frenchTranslation = verb.fr.replace(/er$/, 'ez').replace(/ir$/, 'ez').replace(/re$/, 'ez');
                    } else if (person === 'ils' || person === 'elles') {
                        frenchTranslation = verb.fr.replace(/er$/, 'ent').replace(/ir$/, 'ent').replace(/re$/, 'ent');
                    }
                    
                    // Cas spéciaux pour certains verbes
                    if (verb.fr === 'grogner') {
                        const grogneForms = {
                            'je': 'grogne', 'tu': 'grognes', 'il': 'grogne', 'elle': 'grogne',
                            'nous': 'grognons', 'vous': 'grognez', 'ils': 'grognent', 'elles': 'grognent'
                        };
                        frenchTranslation = grogneForms[person];
                    } else if (verb.fr === 'mordre') {
                        const mordForms = {
                            'je': 'mords', 'tu': 'mords', 'il': 'mord', 'elle': 'mord',
                            'nous': 'mordons', 'vous': 'mordez', 'ils': 'mordent', 'elles': 'mordent'
                        };
                        frenchTranslation = mordForms[person];
                    }
                    
                    fullLexicon[conjugatedForm] = {
                        fr: frenchTranslation,
                        type: 'verbe_conjugué',
                        infinitive: infinitif,
                        person: person,
                        radical: verb.radical
                    };
                });
                
                // Ajouter les traductions inverses (français vers conlang)
                Object.keys(conjugationEndings).forEach(person => {
                    const ending = conjugationEndings[person];
                    const conjugatedForm = person === 'il' || person === 'elle' ? 
                        infinitif : verb.radical + ending;
                    
                    let frenchForm = '';
                    if (verb.fr === 'grogner') {
                        const forms = { 'je': 'grogne', 'tu': 'grognes', 'il': 'grogne', 'elle': 'grogne',
                                      'nous': 'grognons', 'vous': 'grognez', 'ils': 'grognent', 'elles': 'grognent' };
                        frenchForm = forms[person];
                    } else if (verb.fr === 'mordre') {
                        const forms = { 'je': 'mords', 'tu': 'mords', 'il': 'mord', 'elle': 'mord',
                                      'nous': 'mordons', 'vous': 'mordez', 'ils': 'mordent', 'elles': 'mordent' };
                        frenchForm = forms[person];
                    }
                    
                    if (frenchForm && !fullLexicon[frenchForm]) {
                        fullLexicon[frenchForm] = {
                            conlang: conjugatedForm,
                            type: 'verbe_fr',
                            person: person
                        };
                    }
                });
            });
            
            return fullLexicon;
        }

        // Règles grammaticales et conjugaison
        const grammarRules = {
            conjugaison: {
                présent: {
                    'je': 'en',
                    'tu': 'es', 
                    'il': '', // infinitif sans modification
                    'elle': '', // infinitif sans modification
                    'nous': 'avam',
                    'vous': 'avel',
                    'ils': 'arin',
                    'elles': 'arin'
                }
            },
            
            // Fonction pour conjuguer un verbe
            conjugateVerb: function(infinitif, person, tense = 'présent') {
                const verb = lexicon[infinitif];
                if (!verb || verb.type !== 'verbe') return infinitif;
                
                const radical = verb.radical || infinitif.slice(0, -2); // Enlève 'ir' par défaut
                const endings = this.conjugaison[tense];
                
                if (person === 'il' || person === 'elle') {
                    return infinitif; // 3e personne = infinitif
                }
                
                return radical + (endings[person] || '');
            },
            
            // Détection de la négation locale
            processNegation: function(words) {
                const result = [];
                let i = 0;
                
                while (i < words.length) {
                    if (i < words.length - 1 && words[i + 1] === 'nork') {
                        // Le mot actuel + nork = négation
                        result.push({ word: words[i], negated: true });
                        i += 2; // Skip le nork
                    } else {
                        result.push({ word: words[i], negated: false });
                        i++;
                    }
                }
                
                return result;
            }
        };

        let currentDirection = 'conlang-to-french'; // ou 'french-to-conlang'

        function swapLanguages() {
            const inputLabel = document.getElementById('input-label');
            const outputLabel = document.getElementById('output-label');
            const inputText = document.getElementById('input-text');
            const outputText = document.getElementById('output-text');
            
            // Échanger les labels
            const tempLabel = inputLabel.textContent;
            inputLabel.textContent = outputLabel.textContent;
            outputLabel.textContent = tempLabel;
            
            // Échanger les textes
            const tempText = inputText.value;
            inputText.value = outputText.value;
            outputText.value = tempText;
            
            // Changer la direction
            currentDirection = currentDirection === 'conlang-to-french' ? 'french-to-conlang' : 'conlang-to-french';
            
            // Mettre à jour les boutons actifs
            document.querySelectorAll('.lang-option').forEach(btn => btn.classList.toggle('active'));
        }

        function translate() {
            const inputText = document.getElementById('input-text').value.trim().toLowerCase();
            const outputText = document.getElementById('output-text');
            const analysis = document.getElementById('analysis');
            const wordAnalysis = document.getElementById('word-analysis');
            const grammarNotes = document.getElementById('grammar-notes');
            
            if (!inputText) return;

            if (currentDirection === 'conlang-to-french') {
                const result = translateToFrench(inputText);
                outputText.value = result.translation;
                showAnalysis(result.analysis);
            } else {
                const result = translateToConlang(inputText);
                outputText.value = result.translation;
                showAnalysis(result.analysis);
            }
            
            analysis.style.display = 'block';
        }

        function translateToFrench(text) {
            const fullLex = generateAllConjugations();
            const words = text.split(/\s+/);
            const processedWords = grammarRules.processNegation(words);
            let translation = [];
            let analysis = [];
            let grammarNotes = [];

            processedWords.forEach(({ word, negated }) => {
                const entry = fullLex[word];
                if (entry) {
                    let translatedWord = entry.fr;
                    
                    // Traitement de la négation
                    if (negated && (entry.type === 'verbe' || entry.type === 'verbe_conjugué')) {
                        translatedWord = 'ne ' + translatedWord + ' pas';
                        grammarNotes.push(`Négation appliquée à "${word}" (${entry.person})`);
                    }
                    
                    translation.push(translatedWord);
                    analysis.push({
                        original: word + (negated ? ' nork' : ''),
                        translation: translatedWord,
                        type: entry.type + (entry.person ? ' (' + entry.person + ')' : ''),
                        negated: negated
                    });
                } else {
                    translation.push(`[${word}]`);
                    analysis.push({
                        original: word + (negated ? ' nork' : ''),
                        translation: `[inconnu]`,
                        type: 'inconnu',
                        negated: negated
                    });
                }
            });

            return {
                translation: translation.join(' '),
                analysis: analysis,
                grammar: grammarNotes
            };
        }

        function translateToConlang(text) {
            const fullLex = generateAllConjugations();
            const words = text.toLowerCase().split(/\s+/);
            let translation = [];
            let analysis = [];
            let grammarNotes = [];
            let i = 0;

            // Détecter le sujet pour déterminer la conjugaison
            let currentSubject = 'il'; // Par défaut
            let subjectFound = false;

            // Premier passage : identifier le sujet
            for (let j = 0; j < words.length; j++) {
                const phrase = words.slice(0, j + 2).join(' '); // "la bête", etc.
                if (frenchSubjects[phrase]) {
                    currentSubject = frenchSubjects[phrase];
                    subjectFound = true;
                    break;
                }
                if (frenchSubjects[words[j]]) {
                    currentSubject = frenchSubjects[words[j]];
                    subjectFound = true;
                    break;
                }
            }

            // Première étape : identifier et marquer toutes les négations
            let processedSentence = [];
            let tempWords = [...words];
            
            while (tempWords.length > 0) {
                let neIndex = tempWords.indexOf('ne');
                if (neIndex === -1) {
                    // Plus de "ne", ajouter le reste
                    processedSentence = processedSentence.concat(tempWords);
                    break;
                }
                
                // Trouver "pas" après "ne"
                let pasIndex = -1;
                for (let j = neIndex + 1; j < tempWords.length; j++) {
                    if (tempWords[j] === 'pas') {
                        pasIndex = j;
                        break;
                    }
                }
                
                if (pasIndex !== -1) {
                    // Ajouter les mots avant "ne"
                    processedSentence = processedSentence.concat(tempWords.slice(0, neIndex));
                    
                    // Traiter la partie entre "ne" et "pas"
                    const betweenWords = tempWords.slice(neIndex + 1, pasIndex);
                    
                    // Trouver le verbe et le marquer comme négatif
                    let verbProcessed = false;
                    for (let k = 0; k < betweenWords.length; k++) {
                        const w = betweenWords[k];
                        if (!verbProcessed) {
                            // Vérifier si c'est un verbe
                            let verbEntry = Object.keys(fullLex).find(key => {
                                const entry = fullLex[key];
                                return entry.fr === w && entry.person === currentSubject &&
                                       (entry.type === 'verbe' || entry.type === 'verbe_conjugué');
                            });
                            
                            // Si pas trouvé, essayer de trouver n'importe quel verbe avec cette forme française
                            if (!verbEntry) {
                                verbEntry = Object.keys(fullLex).find(key => {
                                    const entry = fullLex[key];
                                    return entry.fr === w && (entry.type === 'verbe' || entry.type === 'verbe_conjugué');
                                });
                            }
                            
                            if (verbEntry) {
                                processedSentence.push({ word: w, negated: true, conlangForm: verbEntry });
                                verbProcessed = true;
                            } else {
                                processedSentence.push({ word: w, negated: false });
                            }
                        } else {
                            processedSentence.push({ word: w, negated: false });
                        }
                    }
                    
                    // Continuer après "pas"
                    tempWords = tempWords.slice(pasIndex + 1);
                } else {
                    // "ne" trouvé mais pas de "pas", traiter normalement
                    processedSentence.push({ word: tempWords[neIndex], negated: false });
                    tempWords = tempWords.slice(neIndex + 1);
                }
            }
            
            // Enlever les logs de debug maintenant que ça marche
            // console.log('Phrase traitée:', processedSentence);
            // console.log('Sujet détecté:', currentSubject);
            processedSentence.forEach(item => {
                if (typeof item === 'string') {
                    item = { word: item, negated: false };
                }
                
                const word = item.word;
                
                if (item.negated && item.conlangForm) {
                    // Verbe négatif
                    translation.push(item.conlangForm + ' nork');
                    analysis.push({
                        original: `ne ${word} pas`,
                        translation: `${item.conlangForm} nork`,
                        type: `verbe_négatif (${currentSubject})`
                    });
                    grammarNotes.push(`Négation détectée sur "${word}"`);
                } else {
                    // Traduction normale
                    let found = false;
                    
                    // Chercher traduction directe
                    const directEntry = Object.keys(fullLex).find(key => {
                        const entry = fullLex[key];
                        return entry.fr === word;
                    });
                    
                    if (directEntry) {
                        translation.push(directEntry);
                        analysis.push({
                            original: word,
                            translation: directEntry,
                            type: fullLex[directEntry].type
                        });
                        found = true;
                    } else {
                        // Chercher un verbe à conjuguer
                        const verbEntry = Object.keys(fullLex).find(key => {
                            const entry = fullLex[key];
                            return entry.fr === word && entry.person === currentSubject &&
                                   (entry.type === 'verbe' || entry.type === 'verbe_conjugué');
                        });
                        
                        if (verbEntry) {
                            translation.push(verbEntry);
                            analysis.push({
                                original: word,
                                translation: verbEntry,
                                type: `verbe (${currentSubject})`
                            });
                            grammarNotes.push(`Verbe conjugué selon le sujet "${currentSubject}"`);
                            found = true;
                        }
                    }
                    
                    if (!found) {
                        translation.push(`[${word}]`);
                        analysis.push({
                            original: word,
                            translation: `[inconnu]`,
                            type: 'inconnu'
                        });
                    }
                }
            });

            return {
                translation: translation.join(' '),
                analysis: analysis,
                grammar: grammarNotes
            };
        }

        function showAnalysis(analysisData) {
            const wordAnalysis = document.getElementById('word-analysis');
            const grammarNotes = document.getElementById('grammar-notes');
            
            wordAnalysis.innerHTML = '';
            analysisData.forEach(item => {
                const tag = document.createElement('div');
                tag.className = 'word-tag';
                let content = `<strong>${item.original}</strong> → ${item.translation} <em>(${item.type})</em>`;
                if (item.negated) content += ' <span style="color: red;">✗ négatif</span>';
                tag.innerHTML = content;
                wordAnalysis.appendChild(tag);
            });

            grammarNotes.innerHTML = analysisData.grammar ? 
                analysisData.grammar.map(note => `<div>📝 ${note}</div>`).join('') : '';
        }

        // Fonction pour ajouter facilement des verbes
        function addVerb(infinitif, frenchTranslation) {
            const radical = infinitif.slice(0, -2); // Enlève 'ir'
            
            // Ajouter l'infinitif
            lexicon[infinitif] = { 
                fr: frenchTranslation, 
                type: 'verbe', 
                infinitive: infinitif, 
                radical: radical 
            };
            
            // Ajouter toutes les conjugaisons automatiquement
            const conjugations = {
                'en': { fr: frenchTranslation.replace(/r$/, 's'), person: 'je' }, // je
                'es': { fr: frenchTranslation.replace(/r$/, 's'), person: 'tu' }, // tu
                'avam': { fr: frenchTranslation.replace(/r$/, 'ons'), person: 'nous' }, // nous
                'avel': { fr: frenchTranslation.replace(/r$/, 'ez'), person: 'vous' }, // vous
                'arin': { fr: frenchTranslation.replace(/r$/, 'ent'), person: 'ils' } // ils
            };
            
            Object.keys(conjugations).forEach(ending => {
                const conjugatedForm = (ending === '' ? infinitif : radical + ending);
                lexicon[conjugatedForm] = {
                    fr: conjugations[ending].fr,
                    type: 'verbe_conjugué',
                    infinitive: infinitif,
                    person: conjugations[ending].person,
                    tense: 'présent'
                };
            });
        }

        // Afficher le dictionnaire au chargement
        function loadDictionary() {
            const fullLex = generateAllConjugations();
            const dictContent = document.getElementById('dictionary-content');
            
            // Grouper par types
            const groups = {
                'Verbes (infinitifs)': {},
                'Articles & Noms': {},
                'Autres mots': {},
                'Conjugaisons': {}
            };
            
            Object.keys(fullLex).forEach(word => {
                const entry = fullLex[word];
                if (entry.type === 'verbe') {
                    groups['Verbes (infinitifs)'][word] = entry;
                } else if (entry.type === 'verbe_conjugué') {
                    groups['Conjugaisons'][word] = entry;
                } else if (entry.type === 'article' || entry.type === 'nom') {
                    groups['Articles & Noms'][word] = entry;
                } else if (entry.fr) { // Seulement les mots avec traduction française
                    groups['Autres mots'][word] = entry;
                }
            });
            
            Object.keys(groups).forEach(groupName => {
                if (Object.keys(groups[groupName]).length > 0) {
                    const groupDiv = document.createElement('div');
                    groupDiv.innerHTML = `<h4 style="color: #495057; margin: 15px 0 10px 0; border-bottom: 1px solid #dee2e6; padding-bottom: 5px;">${groupName}</h4>`;
                    dictContent.appendChild(groupDiv);
                    
                    Object.keys(groups[groupName]).forEach(word => {
                        const entry = groups[groupName][word];
                        const div = document.createElement('div');
                        div.className = 'dict-entry';
                        let content = `<strong>${word}</strong> → ${entry.fr}`;
                        if (entry.person) content += ` <em>(${entry.person})</em>`;
                        if (entry.type) content += ` <small style="color: #6c757d;">[${entry.type}]</small>`;
                        div.innerHTML = content;
                        dictContent.appendChild(div);
                    });
                }
            });
        }

        // Fonction pour ajouter facilement des verbes (appelée depuis la console)
        window.addNewVerb = function(infinitif, radical, frenchTranslation) {
            verbs[infinitif] = { radical: radical, fr: frenchTranslation };
            loadDictionary(); // Recharger le dictionnaire
            console.log(`Verbe ajouté : ${infinitif} (radical: ${radical}) → ${frenchTranslation}`);
        };

        // Traduction automatique au chargement
        window.onload = function() {
            loadDictionary();
            translate(); // Traduit l'exemple par défaut
        };

        // Traduction en temps réel (optionnel)
        document.getElementById('input-text').addEventListener('input', function() {
            setTimeout(translate, 500); // Délai pour éviter trop de calculs
        });
    </script>
</body>
</html>